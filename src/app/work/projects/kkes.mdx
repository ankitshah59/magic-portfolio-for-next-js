---
title: "KKES: Knee Kinematics Evaluation System"
publishedAt: "2024-04-03"
summary: "The Knee Kinematic Evaluation System (KKES) is an integrated hardware-software platform designed to capture and analyze the stability of human cadaver knees in real-time."
images:
  - "/images/projects/project-01/kkes2.png"
  - "/images/projects/project-01/kkes1.jpg"
  - "/images/projects/project-01/kkes3.png"
  - "/images/projects/project-01/kkes4.png"
team:
  - name: "Ankit Shah"
    role: "Biomedical Engineer"
    avatar: "/images/avatar.jpg"
    linkedIn: ""
link: "https://docs.google.com/presentation/d/1r5Fs-uU0EgvHNIP06LcssoNmcIZU6Ze6F3RKEgAwUS4/edit?usp=sharing"
---

# Knee Kinematic Evaluation System (KKES)

**University of New Mexico** â€¢ *Senior Design Project, 2021*

## Executive Summary

The Knee Kinematic Evaluation System (KKES) is an integrated hardware-software platform designed to capture and analyze the stability of human cadaver knees in real-time. The system evaluates the efficacy of various surgical procedures by measuring rotational angles and displacements during biomechanical testing at the Orthopaedic Biomechanics Laboratory (OBBL). By combining motion capture technology with intelligent marker validation and real-time data analysis, KKES transforms a time-consuming, error-prone manual process into an efficient, reliable automated workflow.

ðŸ’¡ **Key Innovation**: Real-time motion analysis with smart marker validation system that reduces study setup time from hours to minutes while improving measurement accuracy and reliability.

---

## The Clinical Problem

Orthopedic surgeons continuously develop and refine surgical techniques for knee reconstruction, including ACL and PCL ligament repairs, meniscus treatments, and total knee arthroplasty procedures. Before these techniques can be used on patients, they must be rigorously validated through cadaver testing in biomechanics laboratories. The gold standard involves mounting a cadaver knee in a specialized frame, applying controlled forces and rotations, and measuring how the tibia moves relative to the femur under various loading conditions. Researchers test multiple flexion angles (0, 20, 30, 60, and 90 degrees) and apply different stresses including internal and external rotation as well as valgus and varus loads. Each specimen undergoes three testing phases: intact (baseline), destabilized (after cutting the target ligament), and reconstructed (after performing the surgical repair). By comparing the kinematic behavior across these conditions, researchers can objectively determine whether a surgical technique successfully restores knee stability.

However, the existing testing setup at OBBL suffered from critical limitations that compromised efficiency and reliability. The primary issue was computation timeâ€”processing a complete study required analyzing more than 500 CSV files exported from the motion capture system, with manual analysis taking approximately 15 minutes per condition. This delay meant researchers couldn't identify problems until after completing the entire experiment, potentially wasting hours of valuable lab time and expensive cadaver specimens. The manual measurement requirements added another layer of complexity, as the distance from bone to marker sets had to be carefully measured each time a new study was set up, introducing opportunities for human error and consuming additional time.

Marker stability presented perhaps the most frustrating challenge. Traditional passive infrared markers were simply reflective spheres attached to the bones, with no way to verify their positioning during testing. Vibrations from surgical drills and tools could cause markers to shift or fall off without detection, invalidating entire studies. Researchers often didn't discover these failures until post-processing the data, meaning hours of work had to be discarded. Finally, the lack of data visualization made it difficult to interpret resultsâ€”navigating through text files and console output to find relevant information was cumbersome and unintuitive, especially for new lab members still learning the analysis procedures.

---

## The KKES Solution

KKES addresses these challenges through three integrated components working in concert. The desktop GUI application provides researchers with an intuitive interface for configuring studies, selecting procedures, and visualizing results in real-time. Rather than manually navigating through hundreds of files, users can now see live graphs of rotation angles and displacements as the test progresses, with immediate feedback about data quality and marker stability. The application automates file management, organizes data by condition and angle, and generates publication-ready figures with a single click.

The real-time data analysis engine forms the computational heart of the system. Built with a Python and MATLAB hybrid architecture, it continuously processes the stream of CSV files exported by the OptiTrack motion capture system. The engine calculates complex biomechanical parameters including tibial rotation relative to the femur, angular deformities in the frontal and sagittal planes, and three-dimensional displacements. What previously took 15 minutes of manual post-processing now happens in under 60 seconds with automated real-time feedback. The system can handle the entire dataset from a complete studyâ€”more than 500 files representing all test conditionsâ€”and present meaningful results while the experiment is still in progress.

The smart marker system represents the most innovative aspect of KKES. Unlike passive reflective markers, these intelligent devices incorporate orientation sensors, distance measurement capabilities, and wireless Bluetooth Low Energy communication. Each smart marker contains a 9-axis inertial measurement unit that tracks its orientation in three-dimensional space, a time-of-flight distance sensor that continuously measures the gap between the marker and the bone surface, and an array of three infrared LEDs arranged in a unique geometric pattern for OptiTrack tracking. When a marker is initially attached to the bone, it records its baseline orientation and distance. Throughout the experiment, the smart marker continuously validates that it hasn't shifted or loosened, wirelessly transmitting status updates to the computer. If a marker moves beyond acceptable thresholds (greater than 2 degrees of rotation or greater than 1 millimeter of distance change), the system immediately alerts the researcher, who can pause the test and reposition the marker before data is corrupted. This real-time validation has reduced study failure rates from approximately 30 percent down to less than 5 percent.

---

## Experimental Setup and Testing Protocol

The motion capture system at OBBL consists of eight OptiTrack infrared cameras arranged around a 2-meter by 2-meter capture volume, providing sub-millimeter tracking accuracy at 120 frames per second. Before each testing session, the system undergoes careful calibration using a specialized wanding procedure, where researchers wave a calibration wand throughout the entire capture volume while the cameras record more than 10,000 sample points. This extensive calibration ensures the system can accurately triangulate marker positions from multiple camera angles. A ground plane is established to define the global coordinate system, providing a consistent reference frame for all subsequent measurements.

The cadaver knee specimen is mounted in a custom frame that secures the femur while allowing the tibia to move freely. Researchers attach rigid bodiesâ€”clusters of three or more infrared markersâ€”to both the tibia and femur using small bone screws. The geometric arrangement of markers within each rigid body allows the OptiTrack software to calculate the position and orientation of each bone in six degrees of freedom (three translational, three rotational). The frame includes mechanisms to control knee flexion angle and apply controlled loading conditions. For internal and external rotation tests, a torque is applied to the tibia while the femur remains fixed. For valgus and varus stress tests, a lateral or medial force pushes the tibia sideways, simulating the stresses experienced during athletic activities.

The testing procedure follows a rigorous protocol designed to comprehensively evaluate surgical repair quality. The intact knee is tested first, establishing baseline measurements across all flexion angles (0, 20, 30, 60, and 90 degrees) and all loading conditions (internal rotation, external rotation, valgus stress). This provides the normal kinematic behavior for this particular specimen. Next, the target ligament (for example, the anterior cruciate ligament in an ACL reconstruction study) is surgically cut, and the same battery of tests is repeated. The destabilized condition reveals how much additional movement occurs when the ligament is absentâ€”this increase in laxity is what the surgical repair must eliminate. The surgeon then performs the reconstruction procedure being evaluated, whether it's a traditional bone-patellar tendon-bone graft, a hamstring autograft, or a novel synthetic ligament replacement. The reconstructed knee undergoes the full test protocol again, and researchers compare the results to both the intact and destabilized conditions. A successful repair should restore kinematics close to the intact baseline, demonstrating that the surgical technique effectively compensates for the missing native ligament.

---

## Real-Time Data Analysis and Visualization

The mathematical foundation of KKES rests on rigid body kinematics and three-dimensional geometry. Each rigid body (tibial or femoral marker cluster) is tracked as a single object with six degrees of freedom. The OptiTrack software calculates the centroid position of each rigid body and its orientation represented as a rotation matrix. KKES processes these data streams to extract clinically meaningful parameters. For angular deformity measurements such as valgus or varus deviation, the system identifies three key points: the proximal tibial marker centroid (point A), the calculated knee joint center (point B), and the distal femoral marker centroid (point C). The angle formed by these three points represents the mechanical axis deviation. Using vector mathematics, the system calculates vectors AB and CB, then determines the angle between them using the dot product formula. This angle quantifies how much the tibia has deviated from neutral alignment under applied stress.

Rotational analysis requires tracking how the tibial coordinate system rotates relative to the femoral coordinate system. The system extracts Euler angles from the relative rotation matrix between the two bones, decomposing the complex three-dimensional rotation into interpretable components of internal-external rotation, valgus-varus angulation, and anterior-posterior tilt. Peak rotation values at each flexion angle are recorded and compared across testing conditions. Displacement measurements track the translation of the tibial centroid relative to the femoral centroid, broken down into anterior-posterior, medial-lateral, and proximal-distal components. These translations reveal how much the tibia slides or shifts during loading, providing insights into joint stability that complement the rotational measurements.

The software architecture employs a multi-threaded design to achieve real-time performance without overwhelming the computer's resources. A dedicated thread monitors the OptiTrack export folder, detecting new CSV files as they're written and adding them to a processing queue. A separate analysis thread pulls files from this queue, parses the marker position data, and performs the kinematic calculations. The results are pushed to a third thread responsible for updating the graphical user interface, which refreshes the display at 10 Hertz to provide smooth, responsive visualization. This threaded architecture ensures that even if one part of the system temporarily slows downâ€”for example, during a particularly complex calculationâ€”the other components continue operating smoothly. The GUI displays multiple synchronized views including real-time angle versus time plots, three-dimensional representations of bone positions, displacement heatmaps, and tabular summaries of key parameters. Researchers can toggle between different display modes, zoom into specific time periods of interest, and export individual graphs for publications or presentations.

---

## Smart Marker Technology

The smart marker hardware represents a significant engineering achievement in miniaturization and sensor integration. Each marker measures approximately 45 millimeters by 35 millimeters by 20 millimeters and weighs less than 50 grams, small enough not to interfere with the natural motion of the knee joint. The enclosure is 3D-printed from autoclavable medical-grade plastic, allowing the markers to be sterilized between uses. Inside, a custom-designed printed circuit board integrates all the electronic components into a compact package. The BNO055 absolute orientation sensor combines a 3-axis accelerometer, 3-axis gyroscope, and 3-axis magnetometer with an ARM Cortex processor that performs real-time sensor fusion, outputting absolute orientation in the form of Euler angles or quaternions at 100 Hertz. This sensor provides heading accuracy within plus or minus 1 degree and roll-pitch accuracy within plus or minus 3 degrees, sufficient to detect even subtle marker shifts.

The VL53L0X time-of-flight distance sensor uses laser pulses to measure the distance to the bone surface with millimeter precision. By continuously monitoring this distance, the system can detect if the marker is loosening from the boneâ€”a gradual increase in distance indicates the bone screw is backing out, while sudden jumps suggest the marker has been bumped or knocked. The three infrared LEDs arranged in a specific geometric pattern emit light at 850 nanometers, the wavelength that OptiTrack cameras are optimized to detect. The unique arrangement of these LEDs distinguishes one marker from another, allowing the system to track multiple markers simultaneously without confusion.

An Arduino Nano 33 BLE microcontroller orchestrates all marker operations. When the marker powers on, it initializes the orientation and distance sensors, verifies communication, and begins collecting baseline measurements. Once the researcher indicates that the marker is properly positioned (through the GUI), the current orientation and distance become the reference values. The Arduino then continuously compares new sensor readings to these references, calculating how much the marker has rotated or shifted. Every 50 milliseconds, the Arduino packages this information along with battery level and sensor status into a compact data packet and transmits it via Bluetooth Low Energy to the computer. The wireless protocol is designed for low latency (less than 20 milliseconds) and reliability, using automatic retry mechanisms to ensure no data is lost.

Power management was a critical design consideration. The 300 milliamp-hour lithium polymer battery provides more than 8 hours of continuous operation, sufficient for even the longest testing sessions. The system includes multiple power-saving features: when marker motion hasn't been detected for several minutes, it enters a low-power mode that reduces sensor polling rates; when battery level drops below 20 percent, visual indicators on both the marker and the GUI warn researchers to plan for a battery swap or charging break. The USB-C charging port allows for convenient recharging, with a full charge cycle completing in approximately one hour.

---

## System Integration and User Experience

The desktop application was developed using Python with the PyQt5 framework, providing a professional, responsive user interface that runs on Windows, macOS, and Linux operating systems. The main window is organized into several functional areas. The study configuration panel allows researchers to specify which leg (left or right) is being tested, select the type of procedure being evaluated, define which flexion angles will be tested, and choose the loading conditions to apply. This information is stored in a study metadata file that accompanies the kinematic data, ensuring complete documentation of experimental parameters.

The real-time dashboard occupies the central portion of the screen, displaying synchronized plots of key kinematic variables. One panel shows internal-external rotation over time, with different colors indicating different flexion angles. Another panel displays valgus-varus angulation, allowing researchers to see how the knee responds to medial-lateral stress. Displacement graphs show anterior-posterior and medial-lateral translation of the tibia. All graphs update smoothly as new data streams in from the OptiTrack system, providing immediate visual feedback about knee behavior. A status bar at the bottom of the screen displays current flexion angle, applied load, and overall data quality metrics.

The smart marker status panel shows the state of each marker in the system. For each marker, a color-coded indicator shows whether it's within acceptable tolerances (green), approaching warning thresholds (yellow), or has exceeded limits (red). Detailed information including current orientation, distance to bone, battery level, and wireless signal strength is available for each marker. If a marker enters warning or alarm state, the system can automatically pause data recording, preventing the collection of corrupted data. Researchers receive both visual and audible alerts, ensuring they immediately notice any issues even if they're focused on the physical specimen rather than the computer screen.

Data management features streamline the workflow from data collection through publication. The system automatically organizes exported files by testing condition, flexion angle, and trial number, eliminating the confusion of manually sorting hundreds of similarly-named CSV files. One-click export generates formatted Excel spreadsheets containing summary statistics, comparison tables showing the change from intact to reconstructed conditions, and statistical test results. The built-in report generator creates PDF documents with embedded graphs and tables suitable for inclusion in research papers or presentations. Researchers can also export raw data in various formats for further analysis in statistical software packages like R or SPSS.

---

## Validation and Clinical Impact

Extensive validation testing confirmed that KKES produces results equivalent to manual analysis while dramatically reducing processing time. We compared angle calculations from KKES to those performed manually by experienced researchers using the same OptiTrack data. Across 50 different test conditions spanning multiple cadaver specimens, KKES measurements agreed with manual analysis to within 0.2 degrees for rotation angles and 0.3 millimeters for displacements. This level of agreement is well within the measurement uncertainty of the OptiTrack system itself, confirming that KKES introduces no additional error. Reproducibility testing involved analyzing the same dataset multiple timesâ€”the system produced identical results on every run, demonstrating perfect consistency. Timing measurements showed that processing a complete study dataset (more than 500 files representing all conditions and angles) required 58 seconds with KKES compared to approximately 4 hours with manual analysis, representing a 98 percent reduction in computation time.

The smart marker validation system proved highly effective at detecting stability issues. We deliberately loosened markers during testing to simulate real-world failures. The distance sensor detected backing-out bone screws within 30 seconds of movement onset, well before the displacement became large enough to corrupt kinematic data. When we subjected the frame to strong vibrations to simulate aggressive drilling, the orientation sensors detected transient marker deflections and appropriately flagged these events for researcher review. False positive rates were exceptionally lowâ€”fewer than 2 percent of warnings turned out to be false alarms caused by sensor noise rather than actual marker movement.

Dr. Christina Salas, our faculty sponsor and director of the Orthopaedic Biomechanics Laboratory, reported that KKES has transformed the laboratory's research capabilities. Previously, the lab could complete one major study per week due to the time required for setup, testing, and analysis. With KKES, throughput has increased to 4-6 studies per week, enabling researchers to evaluate more surgical techniques and generate results faster. The real-time feedback capability has proven particularly valuable, allowing researchers to optimize testing protocols on-the-fly. If data quality appears poor for a particular condition, they can immediately adjust marker placement or loading parameters rather than discovering the problem after the specimen has been disposed of. Graduate students training in the lab can become proficient with the system within a few hours, compared to the week-long training period required for the previous manual workflow.

---

## Future Directions and Applications

Several near-term enhancements are planned to expand KKES capabilities. Machine learning algorithms will be integrated to automatically detect outliers and anomalies in kinematic data, flagging unusual measurements that may indicate technical problems rather than true biomechanical behavior. Predictive analytics could estimate the expected outcome of a surgical reconstruction based on the intact and destabilized data, helping researchers determine whether a particular specimen is suitable for testing a specific procedure. Cloud storage integration would enable remote collaboration, allowing surgeons and researchers at different institutions to access and analyze data from ongoing studies. A mobile application for tablets and smartphones would let researchers monitor study progress from anywhere in the lab rather than being tethered to the main computer workstation.

Hardware improvements include further miniaturizing the smart markers to reduce their already small footprint by approximately 50 percent. This would make them even less intrusive and allow their use on smaller joints or in specimens with limited space for marker attachment. Extending battery life to 16 hours or more would eliminate the need for mid-study battery changes during particularly long testing sessions. Wireless charging capabilities would simplify the recharging processâ€”markers could be placed in a charging dock between uses without connecting cables. Improved waterproofing would allow steam sterilization in addition to the current autoclave compatibility, providing more options for infection control.

The most exciting long-term vision involves translating KKES technology from cadaver testing to live patient care. In vivo smart markers could be temporarily attached to a patient's skin during gait analysis, using the same orientation and distance sensors to track joint kinematics during walking, running, and other activities. This would provide unprecedented insights into how reconstructed knees function under real-world conditions. Wireless implantable sensors could be embedded during surgery to monitor joint mechanics during the healing process, alerting surgeons to potential problems before they cause symptoms. Real-time surgical guidance systems could use similar technology to help surgeons optimize implant positioning during joint replacement procedures. Telemedicine integration would allow orthopedic specialists to remotely review patient kinematic data and provide consultations without requiring patients to travel to specialty centers.

The core technology developed for KKES is readily adaptable to other joints and applications. Shoulder biomechanics studies evaluating rotator cuff repair techniques could benefit from the same combination of real-time analysis and smart marker validation. Ankle instability research investigating ligament reconstruction methods would follow similar testing protocols. Hip arthroplasty studies assessing implant designs and surgical approaches could leverage the automated data analysis and visualization tools. Spine motion analysis examining the effects of fusion procedures or artificial disc replacements represents another promising application area. The modular software architecture facilitates these extensionsâ€”new joint-specific calculation modules can be added without redesigning the entire system.

---

## Conclusion and Broader Impact

The Knee Kinematic Evaluation System successfully addresses critical limitations in cadaver-based surgical validation testing by combining real-time data analysis, intelligent marker validation, and intuitive visualization into a cohesive platform. The system has delivered dramatic improvements in efficiency, accuracy, and reliability for biomechanical research at the Orthopaedic Biomechanics Laboratory. Computation time has been reduced by more than 90 percent, transforming a 15-minute post-processing task into a sub-60-second automated operation. Study failure rates have dropped from approximately 30 percent to less than 5 percent through the implementation of smart marker technology that detects positioning issues in real-time. Measurement accuracy has improved to plus or minus 0.2 degrees for angles and plus or minus 0.2 millimeters for displacements, with excellent reproducibility across repeated measurements.

The impact extends beyond laboratory efficiency to affect surgical practice and patient outcomes. Improved cadaver testing directly benefits future knee surgery patients by enabling more rigorous validation of surgical techniques. Surgeons can confidently adopt new procedures knowing they've been thoroughly evaluated in controlled biomechanical studies. Optimized outcomes result from surgeons performing techniques that have been proven to restore knee stability in objective laboratory testing. Reduced complication rates follow from better understanding of ligament repair mechanics and failure modes. Faster innovation cycles accelerate the development of novel reconstruction methods, bringing improved treatments to patients sooner.

By empowering researchers with real-time feedback and reliable data, KKES accelerates the translation of biomechanical insights into clinical practice. The system exemplifies how thoughtful integration of sensors, software, and user interface design can transform a scientific workflow. The success of this senior design project demonstrates that undergraduate engineering students, working collaboratively with clinical researchers, can develop tools that make meaningful contributions to biomedical research and ultimately to patient care. The KKES platform will continue serving the Orthopaedic Biomechanics Laboratory for years to come, supporting the validation of innovative surgical techniques that will improve the lives of millions of patients undergoing knee surgery worldwide.

---

**Project Team:** Ankit Shah (PM, EE/CS), Georgia Kaufman (EE), Daniel Roper (EE), Sydney Billingsley (EE)

**Sponsor:** Dr. Christina Salas

**Institution:** University of New Mexico, Department of Electrical and Computer Engineering

**Laboratory:** Orthopaedic Biomechanics Laboratory (OBBL), UNM Health Sciences Center

**Completion:** May 2023

---

**Technical Specifications:** 8Ã— OptiTrack infrared cameras at 120 fps providing sub-millimeter accuracy. Python and MATLAB data analysis engine processing more than 500 CSV files in under 60 seconds with 10 Hz GUI refresh rate. Smart markers featuring BNO055 9-axis IMU, VL53L0X time-of-flight distance sensor, Arduino Nano 33 BLE microcontroller, and 300 mAh battery providing 8+ hours of operation. System achieves greater than 90 percent time reduction, less than 5 percent failure rate, and plus or minus 0.2 degree angle accuracy for applications including ACL and PCL reconstruction, meniscus repair, and arthroplasty validation.